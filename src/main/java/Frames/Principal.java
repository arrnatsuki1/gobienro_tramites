package Frames;

import DAO.ILicenciaDAO;
import DAO.IPersonaDAO;
import DAO.LicenciaDAO;
import DAO.PersonaDAO;
import Entidades.Licencia;
import Entidades.Persona;
import Excepciones.RFCExistenteException;
import java.util.Calendar;
import java.util.GregorianCalendar;
import java.util.List;
import javax.swing.JOptionPane;


/**
 * Clase que nos muestra la pantalla principal desde donde realizaremos 
 * todos nuestros tramites
 * @author Rosa Rodriguez y Jose Trista
 */
public class Principal extends javax.swing.JFrame {

    /**
     * Creates new form Principal
     */
    
    private Persona persona;
    /**
     * Metodo constructor donde se recibe un booleano y un objeto de tipo persona
     * en caso de que el logIn sea true esto significa que hay una persona
     * precargada, por lo que se proceden a habilitar los botones solicitar licencia
     * solicitar placa y salir dentro del menu principal
     * @param logIn true or false
     * @param p persona
     */
    public Principal(boolean logIn, Persona p) {
        initComponents();
        persona = p;
        if (logIn) {
            this.botonLicencia.setEnabled(true);
            this.botonPlaca.setEnabled(true);
            this.botonSalir.setEnabled(true);
            this.setTitle(p.getNombre());
        } else {
            this.botonLicencia.setEnabled(false);
            this.botonPlaca.setEnabled(false);
            this.botonSalir.setEnabled(false);
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jButton2 = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        botonLicencia = new swing_propio.GobiernoButton();
        baner = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        botonSalir = new javax.swing.JButton();
        botonSolicitante = new javax.swing.JButton();
        botonPlaca = new swing_propio.GobiernoButton();
        btnReporte = new swing_propio.GobiernoButton();
        btnRecepcion = new swing_propio.GobiernoButton();
        BtnConsultas = new swing_propio.GobiernoButton();
        btnGenerarRegistros = new swing_propio.GobiernoButton();

        jButton2.setText("Licencia");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setResizable(false);

        jPanel1.setBackground(new java.awt.Color(255, 255, 255));
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        botonLicencia.setBackground(new java.awt.Color(255, 255, 255));
        botonLicencia.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        botonLicencia.setText("Solicitar Licencia");
        botonLicencia.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(157, 36, 73), 2, true));
        botonLicencia.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        botonLicencia.setFocusPainted(false);
        botonLicencia.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonLicenciaActionPerformed(evt);
            }
        });
        jPanel1.add(botonLicencia, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 70, 160, 55));

        baner.setBackground(new java.awt.Color(16, 49, 43));

        jLabel1.setText("Tramites");
        jLabel1.setFont(new java.awt.Font("Sitka Subheading", 1, 24)); // NOI18N
        jLabel1.setForeground(new java.awt.Color(255, 255, 255));

        botonSalir.setBackground(new java.awt.Color(157, 36, 73));
        botonSalir.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        botonSalir.setForeground(new java.awt.Color(255, 255, 255));
        botonSalir.setText("Salir");
        botonSalir.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(157, 36, 73), 2, true));
        botonSalir.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        botonSalir.setEnabled(false);
        botonSalir.setFocusPainted(false);
        botonSalir.setRequestFocusEnabled(false);
        botonSalir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonSalirActionPerformed(evt);
            }
        });

        botonSolicitante.setBackground(new java.awt.Color(188, 149, 92));
        botonSolicitante.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        botonSolicitante.setText("Ingresar solicitante");
        botonSolicitante.setBorder(null);
        botonSolicitante.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        botonSolicitante.setFocusPainted(false);
        botonSolicitante.setPreferredSize(new java.awt.Dimension(35, 25));
        botonSolicitante.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonSolicitanteActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout banerLayout = new javax.swing.GroupLayout(baner);
        baner.setLayout(banerLayout);
        banerLayout.setHorizontalGroup(
            banerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(banerLayout.createSequentialGroup()
                .addGap(22, 22, 22)
                .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 132, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(botonSalir, javax.swing.GroupLayout.PREFERRED_SIZE, 109, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 78, Short.MAX_VALUE)
                .addComponent(botonSolicitante, javax.swing.GroupLayout.PREFERRED_SIZE, 170, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        banerLayout.setVerticalGroup(
            banerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(banerLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(banerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(banerLayout.createSequentialGroup()
                        .addGap(5, 5, 5)
                        .addComponent(jLabel1)
                        .addGap(4, 13, Short.MAX_VALUE))
                    .addGroup(banerLayout.createSequentialGroup()
                        .addGroup(banerLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(botonSalir, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(botonSolicitante, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addContainerGap())))
        );

        jPanel1.add(baner, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 541, -1));

        botonPlaca.setBackground(new java.awt.Color(255, 255, 255));
        botonPlaca.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        botonPlaca.setText("Placas");
        botonPlaca.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(157, 36, 73), 2, true));
        botonPlaca.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        botonPlaca.setFocusPainted(false);
        botonPlaca.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                botonPlacaActionPerformed(evt);
            }
        });
        jPanel1.add(botonPlaca, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 180, 160, 55));

        btnReporte.setBackground(new java.awt.Color(255, 255, 255));
        btnReporte.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        btnReporte.setText("Reportes");
        btnReporte.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(157, 36, 73), 2, true));
        btnReporte.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        btnReporte.setFocusPainted(false);
        btnReporte.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnReporteActionPerformed(evt);
            }
        });
        jPanel1.add(btnReporte, new org.netbeans.lib.awtextra.AbsoluteConstraints(360, 180, 160, 55));

        btnRecepcion.setBackground(new java.awt.Color(255, 255, 255));
        btnRecepcion.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        btnRecepcion.setText("Recepcion");
        btnRecepcion.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(157, 36, 73), 2, true));
        btnRecepcion.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        btnRecepcion.setFocusPainted(false);
        btnRecepcion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnRecepcionActionPerformed(evt);
            }
        });
        jPanel1.add(btnRecepcion, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 280, 160, 55));

        BtnConsultas.setBackground(new java.awt.Color(255, 255, 255));
        BtnConsultas.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        BtnConsultas.setText("Historial Persona");
        BtnConsultas.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(157, 36, 73), 2, true));
        BtnConsultas.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        BtnConsultas.setFocusPainted(false);
        BtnConsultas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BtnConsultasActionPerformed(evt);
            }
        });
        jPanel1.add(BtnConsultas, new org.netbeans.lib.awtextra.AbsoluteConstraints(360, 70, 160, 55));

        btnGenerarRegistros.setBackground(new java.awt.Color(255, 255, 255));
        btnGenerarRegistros.setFont(new java.awt.Font("Dialog", 1, 14)); // NOI18N
        btnGenerarRegistros.setText("20 registros");
        btnGenerarRegistros.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(157, 36, 73), 2, true));
        btnGenerarRegistros.setCursor(new java.awt.Cursor(java.awt.Cursor.HAND_CURSOR));
        btnGenerarRegistros.setFocusPainted(false);
        btnGenerarRegistros.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btnGenerarRegistros.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnGenerarRegistrosActionPerformed(evt);
            }
        });
        jPanel1.add(btnGenerarRegistros, new org.netbeans.lib.awtextra.AbsoluteConstraints(360, 280, 160, 55));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, 385, Short.MAX_VALUE)
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents
    
    /**
     * Metodo para ingresar al menu para poder solicitar licencia, 
     * este metodo verifica la edad del solicitante por lo que si es menor a 
     * 18 anios no podra generar una licencia y por ende sacar placas
     * @param evt 
     */
    private void botonLicenciaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonLicenciaActionPerformed
        
        Calendar fechaActual = new GregorianCalendar();
        long edad = fechaActual.get(Calendar.YEAR)-persona.getFechaNacimiento().get(Calendar.YEAR) ;
        
        if(edad < 18) {
            JOptionPane.showMessageDialog(this,
                    "UN MENOR DE EDAD NO PUEDE SACAR UNA LICENCIA(SI PUEDE PERO AQUI NO)",
                    "Informacion", JOptionPane.INFORMATION_MESSAGE);
            return;
        }
        if (persona.tieneLicenciaActiva()) {
            int opcion = JOptionPane.showConfirmDialog(null, "SI SIGUE CON EL PROCESO SE CANCELARA\n"
                    + "LA LICENCIA ANTERIOR", "Confirmar", JOptionPane.YES_NO_OPTION);

            if (opcion == JOptionPane.YES_OPTION) {
                SolicitarLicencia sl = new SolicitarLicencia(persona);
                sl.setVisible(true);
                this.setVisible(false);
            }
        }else{
            SolicitarLicencia sl = new SolicitarLicencia(persona);
            sl.setVisible(true);
            this.setVisible(false);
        }
        
    }//GEN-LAST:event_botonLicenciaActionPerformed
    /**
     * Este boton ya no existe pero no sabemos porque sigue el metodo aqui
     * @param evt 
     */
    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_jButton2ActionPerformed
    /**
     * Metodo para buscar licencias vigentes y en caso de tener proseguir
     * con el menu de solicitar placa
     * @param evt evento
     */
    private void botonPlacaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonPlacaActionPerformed
        buscarLicenciasVigentes(persona);
    }//GEN-LAST:event_botonPlacaActionPerformed
    /**
     * Metodo para entrar al menu de reportes
     * @param evt evento
     */
    private void btnReporteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnReporteActionPerformed
        Reporte rp = new Reporte(false,null);
        rp.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_btnReporteActionPerformed
    /**
     * Metodo para cerrar la sesion del solicitante que este en curso dentro
     * del sistema precargado
     * @param evt evento
     */
    private void botonSalirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonSalirActionPerformed
        this.persona = null;
        this.botonLicencia.setEnabled(false);
        this.botonPlaca.setEnabled(false);
    }//GEN-LAST:event_botonSalirActionPerformed
    /**
     * Metodo para ingresar al menu para ingresar solicitantes
     * @param evt evento
     */
    private void botonSolicitanteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_botonSolicitanteActionPerformed
        IngresaSolicitante i = new IngresaSolicitante();
        i.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_botonSolicitanteActionPerformed
    /**
     * Metodo para generar los 20 registros que se piden dentro del documento
     * @param evt evento
     */
    private void btnGenerarRegistrosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnGenerarRegistrosActionPerformed
        IPersonaDAO dao = new PersonaDAO();
        List<Persona> personas;
        
        try{
            personas = dao.agregar20Personas();
        } catch(RFCExistenteException e) {
            JOptionPane.showMessageDialog(this, "estas personas ya estan agregadas");
            return;
        }
        
        JOptionPane.showMessageDialog(this, "Va a tener 20 mensajes seguidos mostrando la informacion de cada persona agregada");
        
        for(Persona p : personas) {
            
            String msg = String.format("LA PERSONA %s CON RFC %s esta lista para hacer tramites",
                    p.getNombre()+" "+p.getPrimerApellido()+" "+p.getSegundoApellido(),
                    p.getRFC());
                    JOptionPane.showMessageDialog(this, msg);
            
        }
        
        
    }//GEN-LAST:event_btnGenerarRegistrosActionPerformed
    /**
     * Metodo para abrir el menu de recepcion dentro de la pantalla principal
     * @param evt 
     */
    private void btnRecepcionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnRecepcionActionPerformed
        RecepcionDialog r = new RecepcionDialog(this, true);
    }//GEN-LAST:event_btnRecepcionActionPerformed
    /**
     * Metodo para abrir el menu de seleccionar persona para poder
     * proseguir con las consultas
     * @param evt 
     */
    private void BtnConsultasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BtnConsultasActionPerformed
        SeleccionarPersona selecP = new SeleccionarPersona();
        selecP.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_BtnConsultasActionPerformed
    /**
     * Metodo para buscar todas las licencias vigentes de una persona dentro de
     * la base de datos, en caso de que tenga licencias vigentes, se 
     * procedera con el menu para poder solicitar placas
     * @param persona objeto Persona del cual se buscaran todos los tramites
     * de licencia que esten vigentes
     */
    public void buscarLicenciasVigentes(Persona persona){
        ILicenciaDAO licenciadao = new LicenciaDAO();
        List <Licencia> listalicencia = licenciadao.listaLicenciasVigentes(persona);
        if(listalicencia.isEmpty()){
            JOptionPane.showMessageDialog(this, "Usted no tiene licencia vigente");
            return;
        }
        SolicitarPlacas sp = new SolicitarPlacas(persona);
        sp.setVisible(true);
        this.dispose();
    }
    /**
     * Variables declaration - do not modify  
     */
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton BtnConsultas;
    private javax.swing.JPanel baner;
    private javax.swing.JButton botonLicencia;
    private javax.swing.JButton botonPlaca;
    private javax.swing.JButton botonSalir;
    private javax.swing.JButton botonSolicitante;
    private javax.swing.JButton btnGenerarRegistros;
    private javax.swing.JButton btnRecepcion;
    private javax.swing.JButton btnReporte;
    private javax.swing.JButton jButton2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JPanel jPanel1;
    // End of variables declaration//GEN-END:variables
}
